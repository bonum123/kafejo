from rest_framework import serializers

from food.models import Food
from review.serializers import ReviewSerializer, MarkSerializer
from review.models import Review, Mark
from django.db.models import Avg


class FoodSerializer(serializers.ModelSerializer):

    class Meta:
        model = Food
        fields = ['id', 'name', 'desc']


    def to_representation(self, instance):
        representation = super(FoodSerializer, self).to_representation(instance)
        representation['review_count'] = f'{Review.objects.filter(food=instance.id).count()}'
        representation['marks'] = Mark.objects.all().aggregate(Avg('mark'))
        return representation
